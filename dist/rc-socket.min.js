!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).RcSocket={})}(this,(function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(t,e){return t(e={exports:{}},e.exports),e.exports}var o=function(t){return t&&t.Math==Math&&t},r=o("object"==typeof globalThis&&globalThis)||o("object"==typeof window&&window)||o("object"==typeof self&&self)||o("object"==typeof e&&e)||Function("return this")(),i=function(t){try{return!!t()}catch(t){return!0}},c=!i((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),s={}.propertyIsEnumerable,u=Object.getOwnPropertyDescriptor,a={f:u&&!s.call({1:2},1)?function(t){var e=u(this,t);return!!e&&e.enumerable}:s},l=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},f={}.toString,h=function(t){return f.call(t).slice(8,-1)},y="".split,p=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==h(t)?y.call(t,""):Object(t)}:Object,g=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},d=function(t){return p(g(t))},S=function(t){return"object"==typeof t?null!==t:"function"==typeof t},v=function(t,e){if(!S(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!S(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!S(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!S(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")},m={}.hasOwnProperty,_=function(t,e){return m.call(t,e)},b=r.document,O=S(b)&&S(b.createElement),T=!c&&!i((function(){return 7!=Object.defineProperty((t="div",O?b.createElement(t):{}),"a",{get:function(){return 7}}).a;var t})),E=Object.getOwnPropertyDescriptor,R={f:c?E:function(t,e){if(t=d(t),e=v(e,!0),T)try{return E(t,e)}catch(t){}if(_(t,e))return l(!a.f.call(t,e),t[e])}},k=function(t){if(!S(t))throw TypeError(String(t)+" is not an object");return t},w=Object.defineProperty,C={f:c?w:function(t,e,n){if(k(t),e=v(e,!0),k(n),T)try{return w(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},N=c?function(t,e,n){return C.f(t,e,l(1,n))}:function(t,e,n){return t[e]=n,t},L=function(t,e){try{N(r,t,e)}catch(n){r[t]=e}return e},j=r["__core-js_shared__"]||L("__core-js_shared__",{}),I=Function.toString;"function"!=typeof j.inspectSource&&(j.inspectSource=function(t){return I.call(t)});var M,P,G,x,D=j.inspectSource,A=r.WeakMap,F="function"==typeof A&&/native code/.test(D(A)),V=n((function(t){(t.exports=function(t,e){return j[t]||(j[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.0",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})})),q=0,W=Math.random(),Y=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++q+W).toString(36)},H=V("keys"),K={},z=r.WeakMap;if(F){var Q=new z,U=Q.get,B=Q.has,J=Q.set;M=function(t,e){return J.call(Q,t,e),e},P=function(t){return U.call(Q,t)||{}},G=function(t){return B.call(Q,t)}}else{var X=H[x="state"]||(H[x]=Y(x));K[X]=!0,M=function(t,e){return N(t,X,e),e},P=function(t){return _(t,X)?t[X]:{}},G=function(t){return _(t,X)}}var Z,$,tt,et={set:M,get:P,has:G,enforce:function(t){return G(t)?P(t):M(t,{})},getterFor:function(t){return function(e){var n;if(!S(e)||(n=P(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},nt=n((function(t){var e=et.get,n=et.enforce,o=String(String).split("String");(t.exports=function(t,e,i,c){var s=!!c&&!!c.unsafe,u=!!c&&!!c.enumerable,a=!!c&&!!c.noTargetGet;"function"==typeof i&&("string"!=typeof e||_(i,"name")||N(i,"name",e),n(i).source=o.join("string"==typeof e?e:"")),t!==r?(s?!a&&t[e]&&(u=!0):delete t[e],u?t[e]=i:N(t,e,i)):u?t[e]=i:L(e,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||D(this)}))})),ot=r,rt=function(t){return"function"==typeof t?t:void 0},it=Math.ceil,ct=Math.floor,st=function(t){return isNaN(t=+t)?0:(t>0?ct:it)(t)},ut=Math.min,at=function(t){return t>0?ut(st(t),9007199254740991):0},lt=Math.max,ft=Math.min,ht=function(t){return function(e,n,o){var r,i=d(e),c=at(i.length),s=function(t,e){var n=st(t);return n<0?lt(n+e,0):ft(n,e)}(o,c);if(t&&n!=n){for(;c>s;)if((r=i[s++])!=r)return!0}else for(;c>s;s++)if((t||s in i)&&i[s]===n)return t||s||0;return!t&&-1}},yt={includes:ht(!0),indexOf:ht(!1)}.indexOf,pt=function(t,e){var n,o=d(t),r=0,i=[];for(n in o)!_(K,n)&&_(o,n)&&i.push(n);for(;e.length>r;)_(o,n=e[r++])&&(~yt(i,n)||i.push(n));return i},gt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],dt=gt.concat("length","prototype"),St={f:Object.getOwnPropertyNames||function(t){return pt(t,dt)}},vt={f:Object.getOwnPropertySymbols},mt=function(t,e){return arguments.length<2?rt(ot[t])||rt(r[t]):ot[t]&&ot[t][e]||r[t]&&r[t][e]}("Reflect","ownKeys")||function(t){var e=St.f(k(t)),n=vt.f;return n?e.concat(n(t)):e},_t=function(t,e){for(var n=mt(e),o=C.f,r=R.f,i=0;i<n.length;i++){var c=n[i];_(t,c)||o(t,c,r(e,c))}},bt=/#|\.prototype\./,Ot=function(t,e){var n=Et[Tt(t)];return n==kt||n!=Rt&&("function"==typeof e?i(e):!!e)},Tt=Ot.normalize=function(t){return String(t).replace(bt,".").toLowerCase()},Et=Ot.data={},Rt=Ot.NATIVE="N",kt=Ot.POLYFILL="P",wt=Ot,Ct=R.f,Nt=function(t,e){var n,o,i,c,s,u=t.target,a=t.global,l=t.stat;if(n=a?r:l?r[u]||L(u,{}):(r[u]||{}).prototype)for(o in e){if(c=e[o],i=t.noTargetGet?(s=Ct(n,o))&&s.value:n[o],!wt(a?o:u+(l?".":"#")+o,t.forced)&&void 0!==i){if(typeof c==typeof i)continue;_t(c,i)}(t.sham||i&&i.sham)&&N(c,"sham",!0),nt(n,o,c,t)}},Lt=function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function")}(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,o){return t.call(e,n,o)};case 3:return function(n,o,r){return t.call(e,n,o,r)}}return function(){return t.apply(e,arguments)}},jt=function(t){return Object(g(t))},It=Array.isArray||function(t){return"Array"==h(t)},Mt=!!Object.getOwnPropertySymbols&&!i((function(){return!String(Symbol())})),Pt=Mt&&!Symbol.sham&&"symbol"==typeof Symbol(),Gt=V("wks"),xt=r.Symbol,Dt=Pt?xt:Y,At=(_(Gt,Z="species")||(Mt&&_(xt,Z)?Gt[Z]=xt[Z]:Gt[Z]=Dt("Symbol."+Z)),Gt[Z]),Ft=function(t,e){var n;return It(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!It(n.prototype)?S(n)&&null===(n=n[At])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)},Vt=[].push,qt=function(t){var e=1==t,n=2==t,o=3==t,r=4==t,i=6==t,c=5==t||i;return function(s,u,a,l){for(var f,h,y=jt(s),g=p(y),d=Lt(u,a,3),S=at(g.length),v=0,m=l||Ft,_=e?m(s,S):n?m(s,0):void 0;S>v;v++)if((c||v in g)&&(h=d(f=g[v],v,y),t))if(e)_[v]=h;else if(h)switch(t){case 3:return!0;case 5:return f;case 6:return v;case 2:Vt.call(_,f)}else if(r)return!1;return i?-1:o||r?r:_}},Wt={forEach:qt(0),map:qt(1),filter:qt(2),some:qt(3),every:qt(4),find:qt(5),findIndex:qt(6)}.forEach,Yt=(tt=[]["forEach"])&&i((function(){tt.call(null,$||function(){throw 1},1)}))?[].forEach:function(t){return Wt(this,t,arguments.length>1?arguments[1]:void 0)};Nt({target:"Array",proto:!0,forced:[].forEach!=Yt},{forEach:Yt});var Ht=Date.prototype,Kt=Ht.toString,zt=Ht.getTime;new Date(NaN)+""!="Invalid Date"&&nt(Ht,"toString",(function(){var t=zt.call(this);return t==t?Kt.call(this):"Invalid Date"}));var Qt=Object.keys||function(t){return pt(t,gt)},Ut=Object.assign,Bt=Object.defineProperty,Jt=!Ut||i((function(){if(c&&1!==Ut({b:1},Ut(Bt({},"a",{enumerable:!0,get:function(){Bt(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=Ut({},t)[n]||"abcdefghijklmnopqrst"!=Qt(Ut({},e)).join("")}))?function(t,e){for(var n=jt(t),o=arguments.length,r=1,i=vt.f,s=a.f;o>r;)for(var u,l=p(arguments[r++]),f=i?Qt(l).concat(i(l)):Qt(l),h=f.length,y=0;h>y;)u=f[y++],c&&!s.call(l,u)||(n[u]=l[u]);return n}:Ut;Nt({target:"Object",stat:!0,forced:Object.assign!==Jt},{assign:Jt});var Xt,Zt,$t;for(var te in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var ee=r[te],ne=ee&&ee.prototype;if(ne&&ne.forEach!==Yt)try{N(ne,"forEach",Yt)}catch(t){ne.forEach=Yt}}function oe(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function re(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}(Xt=t.RcSocketReadyState||(t.RcSocketReadyState={}))[Xt.CONNECTING=0]="CONNECTING",Xt[Xt.OPEN=1]="OPEN",Xt[Xt.CLOSING=2]="CLOSING",Xt[Xt.CLOSED=3]="CLOSED",(Zt=t.RcSocketCloseType||(t.RcSocketCloseType={}))[Zt.FORCE=0]="FORCE",Zt[Zt.KILL=1]="KILL",Zt[Zt.RETRY=2]="RETRY",($t=t.RcSocketEventName||(t.RcSocketEventName={})).CONNECTING="onconnecting",$t.TIMEOUT="ontimeout",$t.ERROR="onerror",$t.OPEN="onopen",$t.MESSAGE="onmessage",$t.CLOSING="onclosing",$t.CLOSE="onclose";var ie=function(){function e(n,o,r){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),re(this,"settings",{debug:e.defaultSettings.debug,logger:e.defaultSettings.logger,connectionTimeout:e.defaultSettings.connectionTimeout,connectionMaxRetryInterval:e.defaultSettings.connectionMaxRetryInterval}),re(this,"url",void 0),re(this,"protocols",void 0),re(this,"onclose",null),re(this,"onerror",null),re(this,"onmessage",null),re(this,"onopen",null),re(this,"ontimeout",null),re(this,"onconnecting",null),re(this,"onclosing",null),re(this,"readyState",t.RcSocketReadyState.CONNECTING),re(this,"queue",[]),re(this,"_ws",null),re(this,"_attempts",1),re(this,"_shouldReopen",!1),re(this,"_closeType",null),re(this,"_connectTimer",null),this.url=n,this.protocols=o,Object.assign(this.settings,r),setTimeout((function(){return i.open()}),0)}var n,o,r;return n=e,(o=[{key:"open",value:function(){!this.readyState||this.readyState>WebSocket.CLOSING?(this.reset(),this._connect()):this.readyState===WebSocket.CLOSING&&(this._shouldReopen=!0)}},{key:"send",value:function(t){return this.readyState===WebSocket.OPEN?this._send(t):this.queue.push(t)}},{key:"close",value:function(){this._close(t.RcSocketCloseType.FORCE)}},{key:"kill",value:function(){this._close(t.RcSocketCloseType.KILL),this.reset()}},{key:"reboot",value:function(){this.kill(),this._connect()}},{key:"reset",value:function(){this._stop(),this._ws&&(this._ws.onopen=null,this._ws.onclose=null,this._ws.onmessage=null,this._ws.onerror=null),this._ws=null,this.readyState=t.RcSocketReadyState.CONNECTING,this._closeType=null,this._shouldReopen=!1,this._attempts=1}},{key:"_connect",value:function(){var e=this;this._ws=Object.assign(new WebSocket(this.url,this.protocols),{id:Date.now()}),this._ws.onopen=this._onopen.bind(this),this._ws.onclose=this._onclose.bind(this),this._ws.onmessage=this._onmessage.bind(this),this._ws.onerror=this._onerror.bind(this),this._connectTimer=setTimeout((function(){e._trigger(t.RcSocketEventName.TIMEOUT),e._close(t.RcSocketCloseType.RETRY)}),this.settings.connectionTimeout),this._stateChanged(t.RcSocketReadyState.CONNECTING,t.RcSocketEventName.CONNECTING)}},{key:"_stop",value:function(){this._connectTimer&&(clearTimeout(this._connectTimer),this._connectTimer=null)}},{key:"_onopen",value:function(e){if(this._connectTimer&&(clearTimeout(this._connectTimer),this._connectTimer=null),this._closeType===t.RcSocketCloseType.FORCE)return this.close();this._attempts=1,this._stateChanged(t.RcSocketReadyState.OPEN,t.RcSocketEventName.OPEN,e),this._sendQueued()}},{key:"_onclose",value:function(e){this._stop(),this._ws=null,this._closeType===t.RcSocketCloseType.FORCE?(this._stateChanged(t.RcSocketReadyState.CLOSED,t.RcSocketEventName.CLOSE,Object.assign(e,{forced:!0})),this._shouldReopen&&this.open()):(this._closeType!==t.RcSocketCloseType.RETRY&&this._trigger(t.RcSocketEventName.CLOSE,e),this._reconnect())}},{key:"_onmessage",value:function(e){this._trigger(t.RcSocketEventName.MESSAGE,e)}},{key:"_onerror",value:function(e){this._trigger(t.RcSocketEventName.ERROR,e)}},{key:"_close",value:function(e){this._closeType=e,this._shouldReopen=!1,this._ws&&this.readyState<WebSocket.CLOSING&&(this._ws.close(),this._stateChanged(t.RcSocketReadyState.CLOSING,t.RcSocketEventName.CLOSING))}},{key:"_reconnect",value:function(){var t=this,e=1e3*(Math.pow(2,this._attempts)-1);e=e>this.settings.connectionMaxRetryInterval?this.settings.connectionMaxRetryInterval:e,this._attempts++,setTimeout((function(){return t._connect()}),e)}},{key:"_send",value:function(t){this._ws&&this._sendPayload(JSON.stringify(t))}},{key:"_sendPayload",value:function(t){this._ws&&this._ws.send(t)}},{key:"_sendQueued",value:function(){var t=this;this.queue.forEach((function(e){return t._send(e)}))}},{key:"_stateChanged",value:function(t,e,n){this.readyState=t,this._trigger(e,n)}},{key:"_trigger",value:function(t,e){this.settings.debug&&this.settings.logger.debug("RcSocket",t,this.url,e);var n=this[t];n&&n.call(this._ws,e)}}])&&oe(n.prototype,o),r&&oe(n,r),e}();re(ie,"defaultSettings",{debug:!1,logger:console,connectionTimeout:2500,connectionMaxRetryInterval:1e3}),t.default=ie,Object.defineProperty(t,"__esModule",{value:!0})}));
