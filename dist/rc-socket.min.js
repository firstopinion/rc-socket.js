!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).RcSocket={})}(this,(function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(t,e){return t(e={exports:{}},e.exports),e.exports}var o=function(t){return t&&t.Math==Math&&t},r=o("object"==typeof globalThis&&globalThis)||o("object"==typeof window&&window)||o("object"==typeof self&&self)||o("object"==typeof e&&e)||Function("return this")(),i=function(t){try{return!!t()}catch(t){return!0}},c=!i((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),s={}.propertyIsEnumerable,u=Object.getOwnPropertyDescriptor,a={f:u&&!s.call({1:2},1)?function(t){var e=u(this,t);return!!e&&e.enumerable}:s},l=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},f={}.toString,h=function(t){return f.call(t).slice(8,-1)},p="".split,y=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==h(t)?p.call(t,""):Object(t)}:Object,g=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},S=function(t){return y(g(t))},d=function(t){return"object"==typeof t?null!==t:"function"==typeof t},_=function(t,e){if(!d(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!d(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!d(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!d(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")},m={}.hasOwnProperty,v=function(t,e){return m.call(t,e)},b=r.document,O=d(b)&&d(b.createElement),T=!c&&!i((function(){return 7!=Object.defineProperty((t="div",O?b.createElement(t):{}),"a",{get:function(){return 7}}).a;var t})),E=Object.getOwnPropertyDescriptor,R={f:c?E:function(t,e){if(t=S(t),e=_(e,!0),T)try{return E(t,e)}catch(t){}if(v(t,e))return l(!a.f.call(t,e),t[e])}},N=function(t){if(!d(t))throw TypeError(String(t)+" is not an object");return t},C=Object.defineProperty,w={f:c?C:function(t,e,n){if(N(t),e=_(e,!0),N(n),T)try{return C(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},L=c?function(t,e,n){return w.f(t,e,l(1,n))}:function(t,e,n){return t[e]=n,t},k=function(t,e){try{L(r,t,e)}catch(n){r[t]=e}return e},j=r["__core-js_shared__"]||k("__core-js_shared__",{}),I=Function.toString;"function"!=typeof j.inspectSource&&(j.inspectSource=function(t){return I.call(t)});var M,P,G,x,D=j.inspectSource,A=r.WeakMap,F="function"==typeof A&&/native code/.test(D(A)),V=n((function(t){(t.exports=function(t,e){return j[t]||(j[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.0",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})})),q=0,W=Math.random(),Y=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++q+W).toString(36)},H=V("keys"),K={},z=r.WeakMap;if(F){var Q=new z,U=Q.get,B=Q.has,J=Q.set;M=function(t,e){return J.call(Q,t,e),e},P=function(t){return U.call(Q,t)||{}},G=function(t){return B.call(Q,t)}}else{var X=H[x="state"]||(H[x]=Y(x));K[X]=!0,M=function(t,e){return L(t,X,e),e},P=function(t){return v(t,X)?t[X]:{}},G=function(t){return v(t,X)}}var Z,$,tt,et={set:M,get:P,has:G,enforce:function(t){return G(t)?P(t):M(t,{})},getterFor:function(t){return function(e){var n;if(!d(e)||(n=P(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},nt=n((function(t){var e=et.get,n=et.enforce,o=String(String).split("String");(t.exports=function(t,e,i,c){var s=!!c&&!!c.unsafe,u=!!c&&!!c.enumerable,a=!!c&&!!c.noTargetGet;"function"==typeof i&&("string"!=typeof e||v(i,"name")||L(i,"name",e),n(i).source=o.join("string"==typeof e?e:"")),t!==r?(s?!a&&t[e]&&(u=!0):delete t[e],u?t[e]=i:L(t,e,i)):u?t[e]=i:k(e,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||D(this)}))})),ot=r,rt=function(t){return"function"==typeof t?t:void 0},it=Math.ceil,ct=Math.floor,st=function(t){return isNaN(t=+t)?0:(t>0?ct:it)(t)},ut=Math.min,at=function(t){return t>0?ut(st(t),9007199254740991):0},lt=Math.max,ft=Math.min,ht=function(t){return function(e,n,o){var r,i=S(e),c=at(i.length),s=function(t,e){var n=st(t);return n<0?lt(n+e,0):ft(n,e)}(o,c);if(t&&n!=n){for(;c>s;)if((r=i[s++])!=r)return!0}else for(;c>s;s++)if((t||s in i)&&i[s]===n)return t||s||0;return!t&&-1}},pt={includes:ht(!0),indexOf:ht(!1)}.indexOf,yt=function(t,e){var n,o=S(t),r=0,i=[];for(n in o)!v(K,n)&&v(o,n)&&i.push(n);for(;e.length>r;)v(o,n=e[r++])&&(~pt(i,n)||i.push(n));return i},gt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],St=gt.concat("length","prototype"),dt={f:Object.getOwnPropertyNames||function(t){return yt(t,St)}},_t={f:Object.getOwnPropertySymbols},mt=function(t,e){return arguments.length<2?rt(ot[t])||rt(r[t]):ot[t]&&ot[t][e]||r[t]&&r[t][e]}("Reflect","ownKeys")||function(t){var e=dt.f(N(t)),n=_t.f;return n?e.concat(n(t)):e},vt=function(t,e){for(var n=mt(e),o=w.f,r=R.f,i=0;i<n.length;i++){var c=n[i];v(t,c)||o(t,c,r(e,c))}},bt=/#|\.prototype\./,Ot=function(t,e){var n=Et[Tt(t)];return n==Nt||n!=Rt&&("function"==typeof e?i(e):!!e)},Tt=Ot.normalize=function(t){return String(t).replace(bt,".").toLowerCase()},Et=Ot.data={},Rt=Ot.NATIVE="N",Nt=Ot.POLYFILL="P",Ct=Ot,wt=R.f,Lt=function(t,e){var n,o,i,c,s,u=t.target,a=t.global,l=t.stat;if(n=a?r:l?r[u]||k(u,{}):(r[u]||{}).prototype)for(o in e){if(c=e[o],i=t.noTargetGet?(s=wt(n,o))&&s.value:n[o],!Ct(a?o:u+(l?".":"#")+o,t.forced)&&void 0!==i){if(typeof c==typeof i)continue;vt(c,i)}(t.sham||i&&i.sham)&&L(c,"sham",!0),nt(n,o,c,t)}},kt=function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function")}(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,o){return t.call(e,n,o)};case 3:return function(n,o,r){return t.call(e,n,o,r)}}return function(){return t.apply(e,arguments)}},jt=function(t){return Object(g(t))},It=Array.isArray||function(t){return"Array"==h(t)},Mt=!!Object.getOwnPropertySymbols&&!i((function(){return!String(Symbol())})),Pt=Mt&&!Symbol.sham&&"symbol"==typeof Symbol(),Gt=V("wks"),xt=r.Symbol,Dt=Pt?xt:Y,At=(v(Gt,Z="species")||(Mt&&v(xt,Z)?Gt[Z]=xt[Z]:Gt[Z]=Dt("Symbol."+Z)),Gt[Z]),Ft=function(t,e){var n;return It(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!It(n.prototype)?d(n)&&null===(n=n[At])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)},Vt=[].push,qt=function(t){var e=1==t,n=2==t,o=3==t,r=4==t,i=6==t,c=5==t||i;return function(s,u,a,l){for(var f,h,p=jt(s),g=y(p),S=kt(u,a,3),d=at(g.length),_=0,m=l||Ft,v=e?m(s,d):n?m(s,0):void 0;d>_;_++)if((c||_ in g)&&(h=S(f=g[_],_,p),t))if(e)v[_]=h;else if(h)switch(t){case 3:return!0;case 5:return f;case 6:return _;case 2:Vt.call(v,f)}else if(r)return!1;return i?-1:o||r?r:v}},Wt={forEach:qt(0),map:qt(1),filter:qt(2),some:qt(3),every:qt(4),find:qt(5),findIndex:qt(6)}.forEach,Yt=(tt=[]["forEach"])&&i((function(){tt.call(null,$||function(){throw 1},1)}))?[].forEach:function(t){return Wt(this,t,arguments.length>1?arguments[1]:void 0)};Lt({target:"Array",proto:!0,forced:[].forEach!=Yt},{forEach:Yt});var Ht=Date.prototype,Kt=Ht.toString,zt=Ht.getTime;new Date(NaN)+""!="Invalid Date"&&nt(Ht,"toString",(function(){var t=zt.call(this);return t==t?Kt.call(this):"Invalid Date"}));var Qt=Object.keys||function(t){return yt(t,gt)},Ut=Object.assign,Bt=Object.defineProperty,Jt=!Ut||i((function(){if(c&&1!==Ut({b:1},Ut(Bt({},"a",{enumerable:!0,get:function(){Bt(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=Ut({},t)[n]||"abcdefghijklmnopqrst"!=Qt(Ut({},e)).join("")}))?function(t,e){for(var n=jt(t),o=arguments.length,r=1,i=_t.f,s=a.f;o>r;)for(var u,l=y(arguments[r++]),f=i?Qt(l).concat(i(l)):Qt(l),h=f.length,p=0;h>p;)u=f[p++],c&&!s.call(l,u)||(n[u]=l[u]);return n}:Ut;Lt({target:"Object",stat:!0,forced:Object.assign!==Jt},{assign:Jt});var Xt,Zt,$t;for(var te in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var ee=r[te],ne=ee&&ee.prototype;if(ne&&ne.forEach!==Yt)try{L(ne,"forEach",Yt)}catch(t){ne.forEach=Yt}}function oe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}(Xt=t.RcSocketReadyState||(t.RcSocketReadyState={}))[Xt.CONNECTING=0]="CONNECTING",Xt[Xt.OPEN=1]="OPEN",Xt[Xt.CLOSING=2]="CLOSING",Xt[Xt.CLOSED=3]="CLOSED",(Zt=t.RcSocketCloseType||(t.RcSocketCloseType={}))[Zt.FORCE=0]="FORCE",Zt[Zt.KILL=1]="KILL",Zt[Zt.RETRY=2]="RETRY",($t=t.RcSocketEventName||(t.RcSocketEventName={})).CONNECTING="onconnecting",$t.TIMEOUT="ontimeout",$t.ERROR="onerror",$t.OPEN="onopen",$t.MESSAGE="onmessage",$t.CLOSING="onclosing",$t.CLOSE="onclose";var re=function(){function e(n,o,r){var i=this;oe(this,"settings",{debug:e.defaultSettings.debug,logger:e.defaultSettings.logger,connectionTimeout:e.defaultSettings.connectionTimeout,connectionMaxRetryInterval:e.defaultSettings.connectionMaxRetryInterval}),oe(this,"url",void 0),oe(this,"protocols",void 0),oe(this,"onclose",null),oe(this,"onerror",null),oe(this,"onmessage",null),oe(this,"onopen",null),oe(this,"ontimeout",null),oe(this,"onconnecting",null),oe(this,"onclosing",null),oe(this,"readyState",t.RcSocketReadyState.CONNECTING),oe(this,"queue",[]),oe(this,"_ws",null),oe(this,"_attempts",1),oe(this,"_shouldReopen",!1),oe(this,"_closeType",null),oe(this,"_connectTimer",null),this.url=n,this.protocols=o,Object.assign(this.settings,r),setTimeout((function(){return i.open()}),0)}var n=e.prototype;return n.open=function(){!this.readyState||this.readyState>WebSocket.CLOSING?(this.reset(),this._connect()):this.readyState===WebSocket.CLOSING&&(this._shouldReopen=!0)},n.send=function(t){return this.readyState===WebSocket.OPEN?this._send(t):this.queue.push(t)},n.close=function(){this._close(t.RcSocketCloseType.FORCE)},n.kill=function(){this._close(t.RcSocketCloseType.KILL),this.reset()},n.reboot=function(){this.kill(),this._connect()},n.reset=function(){this._stop(),this._ws&&(this._ws.onopen=null,this._ws.onclose=null,this._ws.onmessage=null,this._ws.onerror=null),this._ws=null,this.readyState=t.RcSocketReadyState.CONNECTING,this._closeType=null,this._shouldReopen=!1,this._attempts=1},n._connect=function(){var e=this;this._ws=Object.assign(new WebSocket(this.url,this.protocols),{id:Date.now()}),this._ws.onopen=this._onopen.bind(this),this._ws.onclose=this._onclose.bind(this),this._ws.onmessage=this._onmessage.bind(this),this._ws.onerror=this._onerror.bind(this),this._connectTimer=setTimeout((function(){e._trigger(t.RcSocketEventName.TIMEOUT),e._close(t.RcSocketCloseType.RETRY)}),this.settings.connectionTimeout),this._stateChanged(t.RcSocketReadyState.CONNECTING,t.RcSocketEventName.CONNECTING)},n._stop=function(){this._connectTimer&&(clearTimeout(this._connectTimer),this._connectTimer=null)},n._onopen=function(e){if(this._connectTimer&&(clearTimeout(this._connectTimer),this._connectTimer=null),this._closeType===t.RcSocketCloseType.FORCE)return this.close();this._attempts=1,this._stateChanged(t.RcSocketReadyState.OPEN,t.RcSocketEventName.OPEN,e),this._sendQueued()},n._onclose=function(e){this._stop(),this._ws=null,this._closeType===t.RcSocketCloseType.FORCE?(this._stateChanged(t.RcSocketReadyState.CLOSED,t.RcSocketEventName.CLOSE,Object.assign(e,{forced:!0})),this._shouldReopen&&this.open()):(this._closeType!==t.RcSocketCloseType.RETRY&&this._trigger(t.RcSocketEventName.CLOSE,e),this._reconnect())},n._onmessage=function(e){this._trigger(t.RcSocketEventName.MESSAGE,e)},n._onerror=function(e){this._trigger(t.RcSocketEventName.ERROR,e)},n._close=function(e){this._closeType=e,this._shouldReopen=!1,this._ws&&this.readyState<WebSocket.CLOSING&&(this._ws.close(),this._stateChanged(t.RcSocketReadyState.CLOSING,t.RcSocketEventName.CLOSING))},n._reconnect=function(){var t=this,e=1e3*(Math.pow(2,this._attempts)-1);e=e>this.settings.connectionMaxRetryInterval?this.settings.connectionMaxRetryInterval:e,this._attempts++,setTimeout((function(){return t._connect()}),e)},n._send=function(t){this._ws&&this._sendPayload(JSON.stringify(t))},n._sendPayload=function(t){this._ws&&this._ws.send(t)},n._sendQueued=function(){var t=this;this.queue.forEach((function(e){return t._send(e)}))},n._stateChanged=function(t,e,n){this.readyState=t,this._trigger(e,n)},n._trigger=function(t,e){this.settings.debug&&this.settings.logger.debug("RcSocket",t,this.url,e);var n=this[t];n&&n.call(this._ws,e)},e}();oe(re,"defaultSettings",{debug:!1,logger:console,connectionTimeout:2500,connectionMaxRetryInterval:1e3}),t.default=re,Object.defineProperty(t,"__esModule",{value:!0})}));
